name: Update ArtiLike data

on:
  schedule:
    - cron: '0 4 * * *'  # daily at 04:00 UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Fetch public twitterBookmarks.json
        run: |
          set -e
          curl -sSL "https://gist.githubusercontent.com/sushilathreya/a1f829034015411d3d4b1c4ff6944c0f/raw" -o data/twitterBookmarks.json
          date -u +"%Y-%m-%dT%H:%M:%SZ" > data/last_updated.txt

      - name: Commit changes
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          git add data/twitterBookmarks.json data/last_updated.txt
          if ! git diff --cached --quiet; then
            git commit -m "chore(data): daily update of twitterBookmarks.json"
            git push origin HEAD:master
          else
            echo "No changes to commit."
          fi
